{% extends "login-base.html" %}

{%block content %}

<div class="content">
    <div class="content-header">
        <div>for you</div>
        <div>following</div>
    </div>

    <div class="post-wrapper">
        <div class="profile">
            <!-- for profile image -->
        </div>
        <div class="post-container" id="posts-container">

        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const postsContainer = document.getElementById('posts-container');

        const response = await fetch('{% url "user_posts" %}');
        if (response.ok) {
            const posts = await response.json();

            posts.forEach(post => {

                console.log(post);
                const postElement = document.createElement('div');
                postElement.classList.add('post');

                postElement.innerHTML = `
                 <div class="post-header">
                ${post.username}
                  </div>
            <div class="content-wrapper">
                ${post.content}
            </div>
            <hr>
            <div class="action-wrapper">
                <div class="svg-wrapper">
                    <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 48 48">
                        <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                            d="M43 17.077c0-5.654-4.583-10.238-10.237-10.238c-3.723 0-6.971 1.993-8.763 4.964c-1.792-2.97-5.04-4.964-8.763-4.964C9.583 6.84 5 11.423 5 17.077c0 1.292.25 2.524.687 3.662C9.072 30.476 24 41.161 24 41.161s14.928-10.685 18.314-20.422c.437-1.138.686-2.37.686-3.662" />
                    </svg>
                </div>
                <div class="svg-wrapper">
                    <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 32 32">
                        <path fill="currentColor"
                            d="M26.312 25.407s.141-.095.36-.261C29.948 22.61 32 18.938 32 14.855c0-7.62-7.161-13.808-15.995-13.808S0 7.235 0 14.855c0 7.619 7.161 13.807 15.995 13.807c1.131 0 2.26-.099 3.369-.307l.349-.057c2.245 1.452 5.516 2.651 8.38 2.651c.891 0 1.308-.729.74-1.469c-.864-1.063-2.057-2.76-2.521-4.072zm-1.948-6.032c-.952 1.423-3.911 3.849-8.337 3.849h-.063c-4.437 0-7.391-2.437-8.339-3.849a1.575 1.575 0 0 1-.365-.765a.658.658 0 0 1 .6-.703c.009-.005.015-.005.025-.005a.833.833 0 0 1 .437.151a12.185 12.185 0 0 0 7.672 2.74a11.76 11.76 0 0 0 7.683-2.745a.614.614 0 0 1 .416-.161c.355 0 .636.281.647.631a1.812 1.812 0 0 1-.36.859z" />
                    </svg>
                </div>
                <div class="svg-wrapper">
                    <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 48 48">
                        <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                            d="m30 15l-12.1 6.07m0 5.86l12.18 6.11m12.42 2.89a6.55 6.55 0 1 1-13.1 0a6.55 6.55 0 0 1 13.1 0m-.1-23.86a6.55 6.55 0 1 1-13.1 0a6.55 6.55 0 0 1 13.1 0M18.6 24a6.55 6.55 0 1 1-13.1 0a6.55 6.55 0 0 1 13.1 0" />
                    </svg>
                </div>
                <div class="svg-wrapper" onclick='deletePost("${post.post_id}")'>
                    <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 24 24"><path fill="currentColor" d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"/></svg>
                </div>
                <div class="svg-wrapper" onclick='editPost("${post.post_id}")'>
                    <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M7 7H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-1"/><path d="M20.385 6.585a2.1 2.1 0 0 0-2.97-2.97L9 12v3h3zM16 5l3 3"/></g></svg>
                </div>
                
            </div> 
                `;

                postsContainer.appendChild(postElement);
            });
        } else {
            postsContainer.innerHTML = '<p>Failed to load posts.</p>';
        }
    });

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    
    async function editPost(postId){
        const res = await fetch(`get-post/${postId}/`)
        const data = await res.json()
        console.log(data,"get post");
    }
    async function deletePost(postId) {
        const csrfToken = getCookie('csrftoken'); // Ensure the CSRF token is available
        const response = await fetch(`/delete-post/${postId}/`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken// Include CSRF token in the request
            }
        });
        if (response.ok) {
            // document.getElementById(`post-${postId}`).remove();
            console.log('Post deleted successfully');
        } else {
            console.error('Failed to delete post');
        }
    }
    
</script>
{%endblock%}